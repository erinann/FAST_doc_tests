= Suggested workflow to contribute to the ICES WGFAST convention documents
Erin LaBrecque
:revnumber: 0.01
:revdate: 2020-02-25
:imagesdir: images\
:toc: preamble
:toclevels: 4
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

This workflow is to help contributors who have not used Git or GitHub get started.

If you work regularly with Git and GitHub, please read through link:experienced_github_users.adoc[A quick workflow for experienced Git and GitHub users]. +


== Jargon
These are a few terms you should be familiar with before using Git and GitHub.

* *_Git_* - A type of version control system (software).
* *_GitHub_* - An online (in the cloud) hosting service for Git repositories.
* *_Repository_* - Also called a "repo". A repository tracks all changes made to files in a project over time. Initializing a repository for a project creates a `.git` folder that stores the project's history. If you delete the `.git` folder, you delete the record of all changes to the project files.
* *_Clone_* (n.) / *_Cloning a repo_* (v.) - A clone of a repository is a complete (files and change histories) copy of a repository. You usually clone a repository from GitHub (hosting service) to your computer to work on project files locally.
* *_Fork_* (n.) / *_Forking a repo_* (v.) - This is a special term used by GitHub and a few other hosting services. It is not a Git command. A fork is a cloned repository owned by someone else that you manage in your GitHub account. You are going to fork the `ices-eg/wg_WGFAST` repository to your own GitHub account to work on files independently before submitting any changes back to the `ices-eg/wg_WGFAST` repository.
* *_Upstream repository_* - The repository you fork from.
* *_Remote repository_* - A repository on GitHub or another hosting service.
* *_Local repository_* - A repository on your computer.
* *_Branch_* - Branches of a repository are isolated development areas. You create a branch to work on part of a project without affecting the entire project. Every repository has one default branch, usually called `master`, and can have multiple other branches. You merge branches using a pull request.
* *_Add_* or *_Stage_* - Staging a file allows Git to track changes to that file and tells Git which files can be committed. Staging is the step before committing a file to a repository. You can continue to edit files that have been staged.
* *_Commit_* - Save all staged changes to your local repository.
* *_Push_* - Move changes (commits) from your local repository to a remote repository.
* *_Fetch_* - Retrieve changes from a remote repository without merging the changes into your local repository.
* *_Merge_* - Incorporate the commits and files from a source repository to a target repository into a unified history. You can also merge branches within a repository.
* *_Pull_* - Fetch and merge in one step.
* *_Pull Request_* - Also called a "PR". A pull request tells others about the changes you have made (all the commits) to the project. It is called a pull request because you are asking to pull the changes from a source to a target. You can create a pull request between branches of a single repository or between branches of different repositories. +
{empty} +

TIP: `ices-eg` (ICES Expert Groups) is the team that owns the workspace. `wg_WGFAST` is the repository for the FAST working group. +
{empty} +

image:Git_GitHub_workflow.png[]

== Workflow
Once you have installed Git and a text editor/IDE, set up your GitHub account, AND have a basic understanding of the jargon listed above, you are ready to contribute to the WGFAST convention documents!
{empty} +

[NOTE]
====
Both Atom and Brackets provide GUIs for Git that allow you to work almost exclusively within those IDEs without using a terminal and Git commands. *We suggest that you learn Git from the command line first because it will give you a better understanding of Git's functionality.* This workflow is written to use Git commands in a terminal.
====
{empty} +
Silly things I do not need. 
=== Fork the ices-eg/wg_WGFAST repository
* You only have to do this step once.
- Sign into https://github.com[GitHub] and navigate to the ICES Expert Working Group - wg_WGFAST repository at https://github.com/ices-eg/wg_WGFAST.
- Fork the repository to your account by clicking on the image:fork_button.png[] button.

image:fork_page.png[]
{empty} +
{empty} +

TIP: Forking and cloning both create a copy of a repository, but forking is not a Git function. Forking is only done in GitHub and other hosting services. You fork a repository from another account to work on a copy of that project without affecting the original project. After forking a repository, you can clone it to your local computer to work on it locally.

Once the repository is forked to your GitHub account you can either <<Editing documents in GitHub, edit the documents directly in GitHub>> or clone the repository to your computer and work locally. *We suggest cloning the repository to your local computer unless you are only going to fix a few typographical errors.*
{empty} +

=== Clone the forked repository to your local computer
* You only have to do this step once.
** Click on the repository to open it.
** Click on the clone button. Use `Clone with HTTPS`.
** Click on the clipboard button to save the URL to the clipboard.

//

1. Clone button.
2. Clipboard button. This places a copy of the repository's URL on your clipboard. +

image:clone_button.png[] +
{empty} +

//

1. Open the Git terminal and use the `cd` command to navigate to the directory (folder) you want to copy the repository to.  +

.Example: Changing working directory
----
$ cd Documents/research_projects/
----
{empty} +

TIP: In most terminals you can type the first few characters of the folder and use `Tab` to auto-complete.

{empty} +

[start=2]
2. Clone the forked repository to your local computer. +
Format: `git clone https://github.com/_YOUR-USERNAME_/_YOUR-REPOSITORY_.git` +

.Example: Cloning a repository
----
$ git clone https://github.com/erinann/wg_WGFAST.git
----

.Output
----
Cloning into 'wg_WGFAST'...
remote: Enumerating objects: 551, done.
remote: Total 551 (delta 0), reused 0 (delta 0), pack-reused 551
Receiving objects: 100% (551/551), 728.31 KiB | 2.13 MiB/s, done.
Resolving deltas: 100% (316/316), done.
----

The above `git clone` command created a folder called `wg_WGFAST` (the name of the remote repository) in the `research_projects` directory on erinann's computer, then copied all the files and change histories from the remote `wg_WGFAST` repository into the `wg_WGFAST` folder, creating the local repository. +
{empty} +


=== Add the local repository to a workspace in your text editor/IDE
* You only have to do this step once. +

Now that the repository is on your computer you have add it to a workspace in your text editor/IDE.

*AsciidocFX*: Click on the image:ADFX_folder_icon.png[] and navigate to the folder. +
{empty} +

*Atom*: `File > Add Project Folder...` or `Ctrl + Shift + A` and navigate to the folder. +
{empty} +

*Brackets*: `File > Open Folder...` or `Ctrl + Alt + A` and navigate to the folder. +
{empty} +

You will have to add packages in Atom and extensions in Brackets to preview AsciiDoc files.

.*Atom*:
* asciidoc-assistant +
 Installs the following packages:
** asciidoc-image-helper +
 Provides the ability to past images from the clipboard.
** asciidoc-preview +
 Shows an HTML preview for the AsciiDoc content in the current editor.
** autocomplete-asciidoc +
 AsciiDoc language autocompletions.
** language-asciidoc +
 Syntax highlighting and snippets for AsciiDoc.

* Other packages you might want
** markdown-preview-plus +
 To show an HTML preview of Markdown (`.md`) documents.
** atom-terminal +
 Opens an external terminal in the current directory. +
** terminal-tab
 Opens a terminal pane within Atom in the current directory.

//

.*Brackets*:
* AsciiDoc Preview +
 Live preview of AsciiDoc documents.
* Markdown Preview +
 Live preview of Markdown documents.
* Brackets-Git +
 Integration of Git into Brackets.
* Alice - Spell Checking +
 Adds offline spell checking capabilities to Brackets.
* Alice Dictionaries +
 Provides dictionary data for the Alice spell checker. +
 {empty} +

NOTE: Citation preview does not currently work in Atom or Brackets. Math equation (LaTex math) preview does not currently work in Atom, but you can change the settings of the AsciiDoc Preview extension in Brackets to preview math equations. +
{empty} +

=== Edit
Open an AsciiDoc document in AsciidocFX, Atom, or Brackets and start editing. +
image:editing_2.jpg[height=150, width=150] +

See the link:5_plain_text_editor_help.adoc[Plain Text Editor help] file if you need help using the text editors/IDEs. +
{empty} +

=== Stage and commit
After you have made some edits, save the document, stage it (`git add`), and commit it to your local repository with a useful commit message. Staging files does two things. First, it tells Git which files to track. Second, once a file is being tracked, staging the file tells Git that the file has changed can be committed to the repository. You can continue to edit staged files. It is best practice to commit changes often to keep a record of your work. Each commit is a snapshot of the repository at that time. Building a series of commits creates a change log for the project. +

You can see what files have changed with `git status`.

TIP: Commit early and often!

If you closed the Git terminal, open it and navigate to the working directory of your local repository. Check to see what files have changed. +
----
$ cd Documents/research_projects/wg_WGFAST
$ git status
----

.Output
----
On branch master
Your branch is ahead of 'origin/master' by 2 commits.
  (use "git push" to publish your local commits)

Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
        modified:   How_to_contribute/1_suggested_setup.adoc
        modified:   How_to_contribute/2_suggested_workflow.adoc
        modified:   How_to_contribute/5_plain_text_editor_help.adoc

Untracked files:
  (use "git add <file>..." to include in what will be committed)
        How_to_contribute/7_Atom.adoc
        How_to_contribute/8_Brackets.adoc
no changes added to commit (use "git add" and/or "git commit -a")
----

In this output example, we are working on the master branch of the local repository. Two commits have not been pushed to the remote repository (GitHub), three files have been modified but not staged, and two files have been added to the project folder but not staged so changes are not being tracked.


.Example: Stage and commit all changed files (subject line only)
----
$ git add .
$ git commit -m "Citation updates to acmeta.adoc and ref.bib"
----
The `.` in `$ git add .` tells Git to add all changes in the working directory to the staged area. Nothing is added to the local repository until you run a commit. Git requites a non-empty message with the commit. +

`-m` in `$git commit -m "Citation updates to acmeta.adoc and ref.bib"` adds the commit message that has to be surrounded by quotes. +
{empty} +

TIP: Commit messages with `-m` should be a short (50 characters or less) and concise subject line.

.Example: Stage and commit an individual file (`acmeta.adoc`)
----
$ git add AcMeta/acmeta.adoc
$ git commit -m "Update Section 6.5"
----

WARNING: Do not forget to add the full path to files that are not in the root directory. +
{empty} +


==== Useful commit messages

Do not do this. :wink:

.https://xkcd.com/1296/
image::https://imgs.xkcd.com/comics/git_commit.png[https://xkcd.com/1296/]
{empty} +

Good commit messages help speed up the reviewing process and help future maintainers (including future you) find out why a particular change was made. Every commit message should have a short and concise subject line (see <<Stage and commit>>), but sometimes we need to add more information to the commit message to explain the changes. If you run into a situation where you need more than 50 characters for a commit message, you can write the commit message in the text editor linked to Git. +

----
$ git commit
----
`git commit` will open the text editor you configured when you installed Git, and you will probably see a message in the terminal about waiting for the editor to close the file before it will continue. In the text editor, use the first line to write the subject line, leave a blank line between the subject line and the body, then swrite the rest of the commit message. Each line should not be more than 72 characters long. +


.Seven commonly accepted rules on how to write a Git commit message
. Limit the subject line to 50 characters.
. Capitalize only the first letter in the subject line.
. Do not put a period at the end of the subject line.
. Put a blank line between the subject line and the body.
. Wrap the body at 72 characters.
. Use the imperative mood.
. Describe what was done and why, but not how.
{empty} +


=== Push edits to GitHub
Pushing to GitHub is how you update your remote repository. After you finish editing the document and have committed the changes, push all commits to your remote repository. +

----
$ git push
----
The above command usually implies the form `git push [remote-name] [branch-name]`.

----
$ git push origin master
----


.Potential output
----
Enumerating objects: 13, done.
Counting objects: 100% (13/13), done.
Delta compression using up to 8 threads
Compressing objects: 100% (9/9), done.
Writing objects: 100% (9/9), 1.31 KiB | 103.00 KiB/s, done.
Total 9 (delta 6), reused 0 (delta 0)
remote: Resolving deltas: 100% (6/6), completed with 4 local objects.
To https://github.com/erinann/FAST_doc_tests.git
   810ba2a..73c73af  master -> master
----

{empty} +

=== Submit a Pull Request
After all the edits have been pushed to the remote repository (GitHub), submit a pull request to `ices-eg/wg_WGFAST`. A pull request tells others about the changes you made (all the commits), allows the convention coordinators to approve or deny your changes, and provides an area to discuss the changes if needed. It is called a pull request because you are asking the upstream repository to pull the changes from your fork. +

1. In GitHub, open your `wg_WGFAST` repository, and click on `Pull request`.
** If you want to see the differences between the documents in your forked repository and the upstream repository, click on `Compare`. Your additions will be highlighted in green and subtractions will be highlighted in red.

image:GitHub_PR_1.png[] +
{empty} +

[start=2]
2. Make sure that the `master` branch of the base repository (`ices-eg/wg_WGFAST`) pulls the changes from the correct branch of your repository. In most cases, it will be the `master` branch. Click on `Create pull request`. +

image:GitHub_PR_2.png[] +
{empty} +


[start=3]
3. Add a commit message and extra details in the text editor window, then click `Create pull request`. +

image:GitHub_PR_3.png[] +
{empty} +

Once your pull request has been submitted, a convention coordinator will be notified and will review your edits. Your edits will either be merged into the `ices-eg/wg_WGFAST` master branch by a coordinator or a coordinator might reply back to you asking to clarify or update text. Only convention coordinators have permission to merge pull requests. +
{empty} +

== Updating your forked repository
When you create a fork of a repository you only have the version of the files that are in the repository at that time. Assume you made corrections and edits to the metadata convention document and submitted a pull request that was accepted (:tada: Good job!). A couple days later several other contributors submit pull requests that were accepted. Now you have an old copy of the forked repository and are out of sync with the upstream repo. To update your forked repository you have to "synchronize your fork", also known as "getting upstream updates".


1. Open the Git terminal and navigate to the directory with your local repository. +

.Example
----
$ cd Documents/research_projects/wg_WGFAST
----
{empty} +

[start=2]
2. Configure the remote repository. This tells Git where it needs to look.

First, list the current configured remote repository for your fork. +
----
$ git remote -v
----

.Output
----
origin  https://github.com/erinann/wg_WGFAST.git (fetch)
origin  https://github.com/erinann/wg_WGFAST.git (push)
----
{empty} +


Then specify the `ices-eg/wg_WGFAST` repository as the remote upstream repository. +
----
$ git remote add upstream https://github.com/ices-eg/wg_WGFAST.git
----
{empty} +

Verify the new upstream repository for the fork. +
----
$ git remote -v
----

.Output
----
origin  https://github.com/erinann/wg_WGFAST.git (fetch)
origin  https://github.com/erinann/wg_WGFAST.git (push)
upstream        https://github.com/ices-eg/wg_WGFAST.git (fetch)
upstream        https://github.com/ices-eg/wg_WGFAST.git (push)
----
{empty} +

[start=3]
3. Fetch the commits from the upstream repository.
----
$ git fetch upstream
----
{empty} +

[start=4]
4. Checkout the branch you want to put the commits into. This is usually the `master` branch of your local forked repo.
----
$ git checkout master
----
{empty} +

[start=5]
5. Merge the `upstream/master` into your local `master` to bring your fork's `master` branch in sync with the upstream repository.
----
$ git merge upstream/master
----
{empty} +


== Editing documents in GitHub
Editing large parts of the convention documents directly in GitHub is **not** recommended unless you are an expert in GitHub and AsciiDoc markup. +
{empty} +
The easiest way to edit a few typographical errors, if you do not want to clone the repository to your local computer, is to edit the document directly in GitHub. +


1. After <<Fork the ices-eg/wg_WGFAST repository, forking>> the `ices-eg/wg_WGFAST` repository to your GitHub account, open the repository and click on the file you would like to edit.
{empty} +
{empty} +
image:GitHub_edit_1.png[] +
{empty} +
2. Open the document for editing by clicking to the pencil icon.
{empty} +
{empty} +
image:GitHub_edit_2.png[] +

CAUTION: If you installed a live preivew AsciiDoc browser extension make sure it is turned off. +

{empty} +
3. Edit the document. You can preview the changes before committing them by clicking the `Preview changes` button.
{empty} +
{empty} +
image:GitHub_edit_3.png[] +
{empty} +
4. When you are done editing the document, provide a useful commit message and click `Commit changes`.
{empty} +
{empty} +
image:GitHub_edit_4.png[] +
{empty} +

[CAUTION]
If you cloned the remote repository to your computer and made edits directly in GitHub, you will have to pull those edits to your local repository (computer) before you can push any changes from your local repository back to the remote (GitHub) repository.

[start=5]
5. Submit a <<Submit a Pull Request, pull request>> to send your edits to the `ices-eg/wg_WGFAST` repository.
