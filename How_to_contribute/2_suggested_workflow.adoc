= Suggested workflow to contribute to the ICES WGFAST convention documents
Erin LaBrecque
:revnumber: 0.01
:revdate: 2020-02-25
:imagesdir: images\
:toc: preamble
:toclevels: 4
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
endif::[]

This workflow is to help contributors who have not used Git or GitHub get started.

If you work regularly with Git and GitHub, please read through link:experienced_github_users.adoc[A quick workflow for experienced Git and GitHub users]. +

Contributions to any of the help documents are welcome. :smile: +

== Jargon
These are a few terms you should be familiar with before jumping into the deep end of Git and GitHub.

* *_Git_* - A type of version control system (software).
* *_GitHub_* - An online (in the cloud) hosting service for Git repositories. 
* *_Repository_* - Also called a "repo". A repository tracks all changes made to files in a project over time. Initializing a repository for a project creates a `.git` folder that stores the project's history. If you delete the `.git` folder, you delete the project's history.
* *_Clone_* (n.) / *_Cloning a repo_* (v.) - A cloned repository is a complete copy of a repository. You usually clone a repository from GitHub (hosting service) to your local machine to work on project files locally.
* *_Fork_* (n.) / *_Forking a repo_* (v.) - This is a special term used by GitHub and a few other hosting services. It is not a Git command. A fork is a cloned repository owned by someone else that you manage in your GitHub account. "Forking a repo" means to clone someone else's repository to your account. You are going to fork a copy of the `ices-eg/wg_WGFAST` repository to your own account to work on it independently before submitting any changes back to `ices-eg/wg_WGFAST`. `ices-eg` (ICES Expert Groups) is the team that owns the workspace. `wg_WGFAST` is the repository (project space) for the FAST working group.
* *_Upstream repository_* - The repository you fork from.
* *_Remote repository_* - A repository on GitHub or another hosting service.
* *_Branch_* - Branches of a repository are isolated development areas. You create a branch to work on part of a project without affecting the entire project. Every repository has one default branch, usually called `master`, and can have multiple other branches. You merge branches using a pull request.
* *_Add_* or *_Stage_* - Staging is the step before committing a file to a repository. It is area between your working directory and your repository. You can continue to edit files that have been staged.
* *_Commit_* - "Checking in" a file. Committing a file takes all the changes in the staging area and moves them to the repository.
* *_Push_* - Move changes (commits) from your local machine to a remote repository.
* *_Fetch_* - Retrieve changes from a remote repository without merging the changes into your own branch.
* *_Merge_* - Integrate the contents of the source branch into another branch.
* *_Pull_* - Fetch and merge in one step.
* *_Pull Request_* - Also called a "PR". A pull request tells others about the changes you have made (all the commits) to the project. It is called a pull request because you are asking to pull the changes from a source to a target. You can create a pull request between branches of a single repository or between branches of different repositories. +
{empty} +

image:Git_GitHub_workflow.png[]

== Workflow
Once you have installed Git and a text editor/IDE, set up your GitHub account, AND have a basic understanding of the jargon listed above, you are ready to contribute to the WGFAST convention documents!
{empty} +

[CAUTION]
====
Both Atom and Brackets provide GUIs for Git that allow you to work almost exclusively within those IDEs without using a terminal and Git commands. Atom seems more stable than Brackets, but when testing the packages and extensions that run the Git/GitHub integration, some weird authentication quirks popped up. +

*It is best that you learn Git from the command line first.*
====

=== Fork the ices-eg/wg_WGFAST repository
* You only have to do this step once.
- Sign into https://github.com[GitHub] and navigate to the ICES Expert Working Group - wg_WGFAST repository at https://github.com/ices-eg/wg_WGFAST.
- Fork the repository to your account by clicking on the image:fork_button.png[] button.

image:fork_page.png[]
{empty} +
{empty} +

TIP: Forking and cloning both create a copy of a repository, but forking is not a Git function. Forking is only done in GitHub and other hosting services. You fork a repository from another account to work on a copy of that project without affecting the original project. After forking a repository, you can clone it to your local machine to work on it locally.

Once the repository is forked to your account you can either <<Editing documents in GitHub, edit the documents directly in GitHub>> or clone the repository to your computer and work locally. *We suggest cloning the repository to your local machine unless you are only going to fix a few typographical errors.*
{empty} +

=== Clone the forked repository to your local machine
* You only have to do this step once.
** Click on the repository to open it.
** Click on the clone button. Use `Clone with HTTPS`.
** Click on the clipboard buttom to save the URL to the clipboard.

//

1. Clone button.
2. Clipboard button. This places a copy of the repository's URL on your clipboard. +

image:clone_button.png[] +
{empty} +

//

1. Open the Git terminal and use the `cd` command to navigate to directory (folder) you want to copy the repository to.  +

.Example: Changing working directory
----
$ cd Documents/research_projects/
----
{empty} +

TIP: In most terminals you can type the first few characters of the folder and use `Tab` to autocomplete.

{empty} +

[start=2]
2. Clone the forked repository to your local machine. +
Format: `git clone https://github.com/_YOUR-USERNAME_/_YOUR-REPOSITORY_.git` +

.Example: Cloning a repository
----
$ git clone https://github.com/erinann/wg_WGFAST.git
----

.Output
----
Cloning into 'wg_WGFAST'...
remote: Enumerating objects: 551, done.
remote: Total 551 (delta 0), reused 0 (delta 0), pack-reused 551
Receiving objects: 100% (551/551), 728.31 KiB | 2.13 MiB/s, done.
Resolving deltas: 100% (316/316), done.
----

The above command puts a folder called `wg_WGFAST` in the `research_projects` directory on erinann's local machine with all the files in the wg_WGFAST repository. +
{empty} +


=== Add the repository to a workspace in your text editor/IDE
* You only have to do this step once. +

Now that the repository is on your local machine you have add it to a workspace in your text editor.

*AsciidocFX*: Click on the image:ADFX_folder_icon.png[] and navigate to the folder. +
{empty} +

*Atom*: `File > Add Project Folder...` or `Ctrl + Shift + A` and navigate to the folder. +
{empty} +

*Brackets*: `File > Open Folder...` or `Ctrl + Alt + A` and navigate to the folder. +
{empty} +

You will have to add packages in Atom and extensions in Brackets to preview AsciiDoc files.

.*Atom*:
* asciidoc-assistant +
 Installs the following packages.
** asciidoc-image-helper +
 Provides the ability to past images from the clipboard.
** asciidoc-preview +
 Shows an HTML preview for the AsciiDoc content in the current editor.
** autocomplete-asciidoc +
 AsciiDoc language autocompletions.
** language-asciidoc +
 Syntax highlighting and snippets for AsciiDoc.

* Other packages you might want.
** markdown-preview-plus +
 To show and HTML preview of Markdown (`.md`) documents.
** terminal-tab +
 To use a Git terminal from within Atom. This package is a little flaky - closing the terminal within the editor crashes Atom.

//

.*Brackets*:
* AsciiDoc Preview +
 Live preview for AsciiDoc documents.
* Markdown Preview
 Live preview for Markdown documents.
* Brackets Git +
 Integration of Git into Bracket.
* Alice - Spell Checking +
 Adds offline spell checking capabilities to Brackets.
* Alice Dictionaries +
 Provides dictionary data for the Alice spell checker. +
 {empty} +

NOTE: Citation preview does not currently work in Atom or Brackets. Math equation (LaTex math) preview does not currently work in Atom, but you can change the settings of the AsciiDoc Preview extension in Brackets to preview equations. +
{empty} +

=== Edit
Open an AsciiDoc document in AsciidocFX, Atom, or Brackets and start editing. +
image:editing_2.jpg[height=150, width=150] +

See the link:5_plain_text_editor_help.adoc[Plain Text Editor help] file if you need help using the text editors/IDEs. +
{empty} +

=== Stage and commit
After you have made a series of edits, save the document, stage it (`git add` command), and commit it to your local repository with a useful commit message. Staging tells Git which files in your working directory have changed and should be committed to the repository. You can continue to edit staged files. It is best practice to commit changes often to keep a record of your work. For example, if you finish working on an introduction section, save it and commit the document. +

You can see what files have changed with `git status`.

TIP: Commit early and often!

If you closed the Git terminal, open it and navigate to the working directory of the forked repository. Check to see what files have changed. +
----
$ cd Documents/research_projects/wg_WGFAST
$ git status
----

.Output
----
On branch master
Your branch is ahead of 'origin/master' by 2 commits.
  (use "git push" to publish your local commits)
  
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git restore <file>..." to discard changes in working directory)
        modified:   How_to_contribute/1_suggested_setup.adoc
        modified:   How_to_contribute/2_suggested_workflow.adoc
        modified:   How_to_contribute/5_plain_text_editor_help.adoc
        
Untracked files:
  (use "git add <file>..." to include in what will be committed)
        How_to_contribute/7_Atom.adoc
        How_to_contribute/8_Brackets.adoc
no changes added to commit (use "git add" and/or "git commit -a")
----

In this example, two commits have been made locally but not pushed to the remote repository (GitHub), three files have been modified but not staged, and two files have been added to the project but not staged.


.Example: Stage and commit all changed files
----
$ git add .
$ git commit -m "Citation updates to acmeta.adoc and ref.bib"
----

.Example: Stage and commit an individual file (`acmeta.adoc`)
----
$ git add AcMeta/acmeta.adoc
$ git commit -m "Update Section 6.5"
----

CAUTION: Notice that you have to add the `AcMeta` folder to the path.

{empty} +


=== Push edits to GitHub
Pushing to GitHub is how you update the remote repository. After you finish editing the document and committed the changes, push all commits to your forked repository. +

----
$ git push
----

.Potential output
----
Enumerating objects: 13, done.
Counting objects: 100% (13/13), done.
Delta compression using up to 8 threads
Compressing objects: 100% (9/9), done.
Writing objects: 100% (9/9), 1.31 KiB | 103.00 KiB/s, done.
Total 9 (delta 6), reused 0 (delta 0)
remote: Resolving deltas: 100% (6/6), completed with 4 local objects.
To https://github.com/erinann/FAST_doc_tests.git
   810ba2a..73c73af  master -> master
----

{empty} +

=== Submit a Pull Request
After all the edits have been pushed to the remote repository (GitHub), submit a pull request to `ices-eg/wg_WGFAST`. A pull request tells others about the changes you made (all the commits), allows the convention coordinators to approve or deny the changes, and provides an area to discuss the changes if needed. It is called a pull request because you are asking the upstream repository to pull the changes from your fork. +

1. In GitHub, open your `wg_WGFAST` repository, and click on `Pull request`. 
** If you want to see the differences between the documents in your forked repository and the upstream repository, click on `Compare`. Your additions will be highlighted in green and subtactions will be hightlighed in red.

image:GitHub_PR_1.png[] +
{empty} +

[start=2]
2. Make sure that the `master` branch of base repository (`ices-eg/wg_WGFAST`) pulls the changes from the correct branch of your repository. In most cases, it will be the `master` branch. Click on `Create pull request`. +

image:GitHub_PR_2.png[] +
{empty} +


[start=3]
3. Add a commit message.
Place holder. Waiting to add image.
{empty} +

Once your pull request has been submitted, a convention coordinator will be notified and will review your edits. Your edits will either be merged into the `ices-eg/wg_WGFAST` master branch by a coordinator or a coordinator might reply back to you asking to clarify or update text. Only convention coordinators have the permissions to merge a pull request. +
{empty} +

== Updating your forked repository
When you create a fork of a repository you only have the version of the files that are in the repository at that time. Assume you made corrections and edits to the metadata convention document and submitted a pull request that was accepted (:tada: Good job!). A couple days later several other contributors submit pull requests that were accepted. Now you have an old copy of the forked repository and are out of sync with the upstream repo. To update your forked repository you have to "synchronize your fork", also known as "getting upstream updates".


1. Open the Git terminal and navigate to the directory with your local repository. +

.Example
----
$ cd Documents/research_projects/wg_WGFAST
----
{empty} +

[start=2]
2. Configure the remote repository. This tells Git where it needs to look.

First, list the current configured remote repository for your fork. +
----
$ git remote -v
----

.Output
----
origin  https://github.com/erinann/wg_WGFAST.git (fetch)
origin  https://github.com/erinann/wg_WGFAST.git (push)
----
{empty} +


Then specify the `ices-eg/wg_WGFAST` repository as the remote upstream repository. +
----
$ git remote add upstream https://github.com/ices-eg/wg_WGFAST.git
----
{empty} +

Verify the new upstream repository for the fork. +
----
$ git remote -v
----

.Output
----
origin  https://github.com/erinann/wg_WGFAST.git (fetch)
origin  https://github.com/erinann/wg_WGFAST.git (push)
upstream        https://github.com/ices-eg/wg_WGFAST.git (fetch)
upstream        https://github.com/ices-eg/wg_WGFAST.git (push)
----
{empty} +

[start=3]
3. Fetch the commits from the upstream repository.
----
$ git fetch upstream
----
{empty} +

[start=4]
4. Checkout the branch you want to put the commits into. This is usually the `master` branch of your local forked repo.
----
$ git checkout master
----
{empty} +

[start=5]
5. Merge the `upstream/master` into your local `master` to bring your fork's `master` branch in sync with the upstream repository.
----
$ git merge upstream/master
----
{empty} +


== Editing documents in GitHub
Editing large parts of the convention documents directly in GitHub is **not** recommended unless you are an expert in GitHub and AsciiDoc markup. +
{empty} +
The easiest way to edit a few typographical errors, if you do not want to clone the repository to your local machine, is to edit the document directly in GitHub. +


1. After <<Fork the ices-eg/wg_WGFAST repository, forking>> the `ices-eg/wg_WGFAST` repository to your GitHub account, open the repository and click on the file you would like to edit.
{empty} +
{empty} +
image:GitHub_edit_1.png[] +
{empty} +
2. Open the document for editing by clicking to the pencil icon.
{empty} +
{empty} +
image:GitHub_edit_2.png[] +
{empty} +
{empty} +
3. Edit the document. You can preview the changes before committing's them by clicking the `Preview changes` button.
{empty} +
{empty} +
image:GitHub_edit_3.png[] +
{empty} +
4. When you are done editing the document, provide a useful commit message and click `Commit changes`.
{empty} +
{empty} +
image:GitHub_edit_4.png[] +
{empty} +

[CAUTION]
If you cloned the repository on your local machine but made edits directly in GitHub, you will have to pull those edits to the copy on your local machine before you can push any changes back to the GitHub repository.

[start=5]
5. Submit a <<Submit a Pull Request, pull request>> to submit your edits to the `ices-eg/wg_WGFAST` repository.
